/**
 * @license almond 0.2.9 Copyright (c) 2011-2014, The Dojo Foundation All Rights Reserved.
 * Available via the MIT or new BSD license.
 * see: http://github.com/jrburke/almond for details
 */

// MIT license

var requirejs,require,define;(function(e){function h(e,t){return f.call(e,t)}function p(e,t){var n,r,i,s,o,a,f,l,h,p,d,v=t&&t.split("/"),m=u.map,g=m&&m["*"]||{};if(e&&e.charAt(0)===".")if(t){v=v.slice(0,v.length-1),e=e.split("/"),o=e.length-1,u.nodeIdCompat&&c.test(e[o])&&(e[o]=e[o].replace(c,"")),e=v.concat(e);for(h=0;h<e.length;h+=1){d=e[h];if(d===".")e.splice(h,1),h-=1;else if(d===".."){if(h===1&&(e[2]===".."||e[0]===".."))break;h>0&&(e.splice(h-1,2),h-=2)}}e=e.join("/")}else e.indexOf("./")===0&&(e=e.substring(2));if((v||g)&&m){n=e.split("/");for(h=n.length;h>0;h-=1){r=n.slice(0,h).join("/");if(v)for(p=v.length;p>0;p-=1){i=m[v.slice(0,p).join("/")];if(i){i=i[r];if(i){s=i,a=h;break}}}if(s)break;!f&&g&&g[r]&&(f=g[r],l=h)}!s&&f&&(s=f,a=l),s&&(n.splice(0,a,s),e=n.join("/"))}return e}function d(t,r){return function(){return n.apply(e,l.call(arguments,0).concat([t,r]))}}function v(e){return function(t){return p(t,e)}}function m(e){return function(t){s[e]=t}}function g(n){if(h(o,n)){var r=o[n];delete o[n],a[n]=!0,t.apply(e,r)}if(!h(s,n)&&!h(a,n))throw new Error("No "+n);return s[n]}function y(e){var t,n=e?e.indexOf("!"):-1;return n>-1&&(t=e.substring(0,n),e=e.substring(n+1,e.length)),[t,e]}function b(e){return function(){return u&&u.config&&u.config[e]||{}}}var t,n,r,i,s={},o={},u={},a={},f=Object.prototype.hasOwnProperty,l=[].slice,c=/\.js$/;r=function(e,t){var n,r=y(e),i=r[0];return e=r[1],i&&(i=p(i,t),n=g(i)),i?n&&n.normalize?e=n.normalize(e,v(t)):e=p(e,t):(e=p(e,t),r=y(e),i=r[0],e=r[1],i&&(n=g(i))),{f:i?i+"!"+e:e,n:e,pr:i,p:n}},i={require:function(e){return d(e)},exports:function(e){var t=s[e];return typeof t!="undefined"?t:s[e]={}},module:function(e){return{id:e,uri:"",exports:s[e],config:b(e)}}},t=function(t,n,u,f){var l,c,p,v,y,b=[],w=typeof u,E;f=f||t;if(w==="undefined"||w==="function"){n=!n.length&&u.length?["require","exports","module"]:n;for(y=0;y<n.length;y+=1){v=r(n[y],f),c=v.f;if(c==="require")b[y]=i.require(t);else if(c==="exports")b[y]=i.exports(t),E=!0;else if(c==="module")l=b[y]=i.module(t);else if(h(s,c)||h(o,c)||h(a,c))b[y]=g(c);else{if(!v.p)throw new Error(t+" missing "+c);v.p.load(v.n,d(f,!0),m(c),{}),b[y]=s[c]}}p=u?u.apply(s[t],b):undefined;if(t)if(l&&l.exports!==e&&l.exports!==s[t])s[t]=l.exports;else if(p!==e||!E)s[t]=p}else t&&(s[t]=u)},requirejs=require=n=function(s,o,a,f,l){if(typeof s=="string")return i[s]?i[s](o):g(r(s,o).f);if(!s.splice){u=s,u.deps&&n(u.deps,u.callback);if(!o)return;o.splice?(s=o,o=a,a=null):s=e}return o=o||function(){},typeof a=="function"&&(a=f,f=l),f?t(e,s,o,a):setTimeout(function(){t(e,s,o,a)},4),n},n.config=function(e){return n(e)},requirejs._defined=s,define=function(e,t,n){t.splice||(n=t,t=[]),!h(s,e)&&!h(o,e)&&(o[e]=[e,t,n])},define.amd={jQuery:!0}})(),define("../node_modules/almond/almond",function(){}),define("Vector",[],function(){var e=function(e,t){this.elems=arguments.length===1?e:[e||0,t||0]};return e.size=function(t){return t?new e(t.outerWidth(),t.outerHeight()):new e},e.offset=function(t){return t?new e(t.offset().left,t.offset().top):new e},e.prototype.mouse=function(e){return this.elems=[e.pageX,e.pageY],this},e.prototype.offset=function(e){return arguments.length===0?{left:this.elems[0],top:this.elems[1]}:(this.elems=[e.left,e.top],this)},e.prototype.x=function(e){return arguments.length===0?this.elems[0]:(this.elems[0]=e,this)},e.prototype.y=function(e){return arguments.length===0?this.elems[1]:(this.elems[1]=e,this)},e.prototype.multiply=function(t){return new e(this.elems.map(function(e){return e*t}))},e.prototype.round=function(){return new e(this.elems.map(Math.round))},e.prototype.add=function(t){return new e(this.elems[0]+t.elems[0],this.elems[1]+t.elems[1])},e.prototype.subtract=function(t){return new e(this.elems[0]-t.elems[0],this.elems[1]-t.elems[1])},e.prototype.copy=function(){return new e(this.elems[0],this.elems[1])},e}),define("Player",["Vector"],function(e){var t=function(t){this.$elem=t,this.$elem.css("position","absolute"),this.size=e.size(this.$elem),this.p=e.offset(this.$elem),this.v=new e,this.a=new e(0,1),this.runAccel=.7,this.jumpSpeed=-17,this.platformPosition=.5,this.running=0,this.jumping=0,this.runUp=!1,this.backOff=!1,this.grounded=!0,this.platform=null,this.nextPlatform=null,this.target=null,this.states=[],this.route=[]},n=5;return t.prototype.update=function(){this.backOff!==!1&&(this.running=-this.direction(this.nextPlatform),this.backOff<=0?this.runUp=!0:this.backOff--);if(this.runUp){this.backOff=!1,this.running=this.direction(this.nextPlatform);var e=.4,t=this.checkJumpHeight(this.nextPlatform,e),r=this.requiredVelocity(this.nextPlatform,this.jumpFrames(this.nextPlatform,e));if(t&&(r===0||(r>0?this.v.x()>=r:this.v.x()<=r))&&this.stoppingDistance()<=this.nextPlatform.size.x()-n*2-this.size.x())Math.abs(this.v.x()-r)>1?this.running=this.v.x()>0?-1:1:(this.v.x(r),this.a.x(0),this.jumping=e);else{r=this.requiredVelocity(this.nextPlatform,this.jumpFrames(this.nextPlatform));var i=this.slowingDistance(this.requiredSpeed(this.nextPlatform)),s=this.v.x()>0?this.platform.right()-this.right():this.left()-this.platform.left();s<=i&&(this.running=this.v.x()>0?-1:1),(this.running>0?this.right()>this.platform.right():this.left()<this.platform.left())?(this.v.x(r),this.a.x(0),this.jumping=1):(r===0||(r>0?this.v.x()>=r:this.v.x()<=r))&&this.stoppingDistance()<=this.nextPlatform.size.x()-n*2-this.size.x()&&(Math.abs(this.v.x()-r)>1?this.running=this.v.x()>0?-1:1:(this.v.x(r),this.a.x(0),this.jumping=1))}}this.jumping&&(this.runUp=!1,this.running=0,this.v.y(this.jumpSpeed*this.jumping),this.jumping=0),this.nextPlatform&&(this.a.x(this.grounded&&this.runAccel*this.running),!this.grounded&&this.v.y()>0&&(this.platform=this.nextPlatform,this.nextPlatform=null)),this.v=this.v.add(this.a),this.p=this.p.add(this.v),this.grounded=this.p.y()>=this.platform.ground();if(this.grounded){this.v.x(this.v.x()*this.platform.mu),this.p.y(this.platform.ground()),this.v.y(0),!this.nextPlatform&&this.route.length&&this.jump(this.route.shift());if(!this.nextPlatform){var o=this.platform.positionFromRatio(this.platformPosition)-this.size.x()/2;o=Math.max(this.platform.left()+n,o),o=Math.min(this.platform.right()-n-this.size.x(),o),this.v.x()>0&&this.stoppingDistance()>=this.platform.right()-this.right()?this.a.x(-this.runAccel):this.v.x()<0&&this.stoppingDistance()>=this.left()-this.platform.left()?this.a.x(this.runAccel):o-this.p.x()>5?this.a.x(this.runAccel):this.p.x()-o>5?this.a.x(-this.runAccel):Math.abs(this.v.x())>2?this.a.x(0):(this.v.x(0),this.a.x(0))}}return this},t.prototype.findPaths=function(e){this.pushState(),this.tree=[];for(var t=0;t<e.length;t++){this.moveTo(e[t]),this.tree[t]=[];for(var n=0;n<e.length;n++)n!==t&&this.couldJump(e[n])&&this.tree[t].push(n)}this.popState()},t.prototype.moveTo=function(e){this.platform=e,this.p.y(this.platform.ground()),this.p.x(this.platform.p.x())},t.prototype.pushState=function(){this.states.push({p:this.p.copy(),v:this.v.copy(),a:this.a.copy(),size:this.size.copy(),platform:this.platform,target:this.nextPlatform,running:this.running,jumping:this.jumping,runUp:this.runUp,backOff:this.backOff,grounded:this.grounded,route:this.route.slice(0)})},t.prototype.popState=function(){var e=this.states.pop();this.size=e.size,this.p=e.p,this.v=e.v,this.a=e.a,this.platform=e.platform,this.nextPlatform=e.target,this.running=e.running,this.jumping=e.jumping,this.runUp=e.runUp,this.backOff=e.backOff,this.grounded=e.grounded,this.route=e.route},t.prototype.direction=function(e){return this.left()<e.left()?1:this.right()>e.right()?-1:0},t.prototype.jumpHeight=function(e){this.pushState(),this.route=[],this.runUp=!1,this.backOff=!1,this.jumping=e||1,this.p.y(0),this.update();while(this.v.y()<0)this.update();var t=this.p.y();return this.popState(),Math.abs(t)},t.prototype.jumpFrames=function(e,t){this.pushState(),this.p.y(this.platform.ground()),this.nextPlatform=e,this.route=[],this.runUp=!1,this.backOff=!1,this.jumping=t||1;var n=1;this.update();while(this.v.y()<0||this.p.y()<this.platform.ground())this.update(),n++;return this.popState(),n},t.prototype.requiredVelocity=function(e,t){var r=this.direction(e);if(r===0)return 0;if(r===1)return(e.left()-this.left()+n)/t;if(r===-1)return-(this.right()-e.right()+n)/t},t.prototype.slowingDistance=function(e){this.pushState();var t=this.v.x()>0?1:-1;this.running=-t,this.route=[],this.nextPlatform=!0,this.runUp=!1,this.backOff=!1;var n=this.p.x();while(this.v.x()*t>e)this.update();var r=this.p.x();return this.popState(),Math.abs(r-n)},t.prototype.stoppingDistance=function(){return this.slowingDistance(0)},t.prototype.requiredSpeed=function(e){this.pushState(),this.p.x(this.direction(e)>0?this.platform.right()-this.size.x():this.platform.left());var t=Math.abs(this.requiredVelocity(e,this.jumpFrames(e)));return this.popState(),t},t.prototype.over=function(e){return this.left()>=e.left()&&this.right()<=e.right()},t.prototype.couldJump=function(e){return this.checkJumpHeight(e)?this.maxSpeed()>=this.requiredSpeed(e)&&this.couldStop(e):!1},t.prototype.couldStop=function(e){this.pushState();var t=this.requiredSpeed(e);this.v.x(t);var r=this.stoppingDistance()<=e.size.x()-n*2-this.size.x();return this.popState(),r},t.prototype.computeBackOffJump=function(e){var t,n=0,r=-this.direction(e);for(;;){this.pushState(),this.nextPlatform=e,this.route=[],this.runUp=!1,this.backOff=!1,this.running=r;for(t=0;t<n;t++)this.update();this.running=-r;while(this.v.x()*-this.running>0)this.update();if(r>0?this.right()>this.platform.right():this.left()<this.platform.left()){n>0&&n--;break}if(this.canJump(e))break;this.popState(),n++}return this.popState(),n},t.prototype.checkJumpHeight=function(e,t){return this.jumpHeight(t)>=this.platform.ground()-e.ground()},t.prototype.maxSpeed=function(){this.pushState(),this.p.x(this.platform.p.x()),this.v.x(0),this.nextPlatform=!0,this.route=[],this.runUp=!1,this.backOff=!1,this.running=1;while(this.over(this.platform))this.update();var e=Math.abs(this.v.x());return this.popState(),e},t.prototype.canJump=function(e){if(!this.checkJumpHeight(e))return!1;this.pushState();var t=this.jumpFrames(e);this.nextPlatform=e,this.route=[],this.runUp=!1,this.backOff=!1,this.running=this.direction(e);while(this.over(this.platform)){if(Math.abs(this.v.x())>=Math.abs(this.requiredVelocity(e,t)))return this.popState(),!0;this.update()}return this.popState(),!1},t.prototype.jump=function(e){if(this.platform===e)return;if(!this.couldJump(e))return;this.nextPlatform=e,this.backOff=this.computeBackOffJump(e)},t.prototype.jumpTo=function(e,t){if(e===this.target)return;this.target=e,this.route=this.findRoute(e,t)},t.prototype.runTo=function(e){this.platformPosition=e},t.prototype.findRoute=function(e,t){var n=this.backOff!==!1||this.runUp||this.jumping||!this.grounded,r=n?this.nextPlatform||this.platform:this.platform,i=[{position:r.id,route:[r]}],s=[],o={},u,a,f,l,c;while(i.length>0){for(u=0;u<i.length;u++){f=i[u];if(f.position===e.id)return f.route.slice(1);l=this.tree[f.position];for(a=0;a<l.length;a++){if(o[l[a]])continue;c=f.route.slice(0),c.push(t[l[a]]),s.push({position:l[a],route:c}),o[l[a]]=!0}}i=s,s=[]}return[]},t.prototype.left=function(){return this.p.x()},t.prototype.right=function(){return this.p.x()+this.size.x()},t.prototype.top=function(){return this.p.y()-this.size.y()},t.prototype.bottom=function(){return this.p.y()},t.prototype.draw=function(){return this.$elem.offset((new e(parseInt(this.p.x(),10),parseInt(this.p.y()-this.size.y(),10))).offset()),this},t}),define("Platform",["Vector"],function(e){var t=function(t,n){this.$elem=t,this.p=new e,this.size=new e,this.mu=.96,this.type=n||"top",this.update()};return t.prototype.left=function(){return this.p.x()},t.prototype.right=function(){return this.p.x()+this.size.x()},t.prototype.top=function(){return this.p.y()},t.prototype.bottom=function(){return this.p.y()+this.size.y()},t.prototype.ground=function(){return this.p.y()+(this.type==="bottom"?this.size.y():0)},t.prototype.lateralRatio=function(e){return e.x()<this.left()?0:e.x()>this.right()?1:(e.x()-this.p.x())/this.size.x()},t.prototype.positionFromRatio=function(e){return e*this.size.x()+this.p.x()},t.prototype.lateralDistanceFromPlayer=function(e){if(e.right()>=this.left()&&e.left()<=this.right())return 0;if(e.right()<this.left())return this.left()-e.right();if(e.left()>this.right())return e.left()-this.right()},t.prototype.verticalDistanceFromPlayer=function(e){if(e.bottom()>=this.top()&&e.top()<=this.bottom())return 0;if(e.bottom()<this.top())return this.top()-e.bottom();if(e.top()>this.bottom())return e.top()-this.bottom()},t.prototype.distanceFromPlayer=function(e){return Math.sqrt(Math.pow(this.lateralDistanceFromPlayer(e),2)+Math.pow(this.verticalDistanceFromPlayer(e),2))},t.prototype.lateralDistanceFrom=function(e){return e.x()<this.left()?this.left()-e.x():e.x()>this.right()?e.x()-this.right():0},t.prototype.jumpDistanceFrom=function(e){return Math.sqrt(Math.pow(this.ground()-e.y(),2)+Math.pow(this.lateralDistanceFrom(e),2))},t.prototype.update=function(){return this.size=e.size(this.$elem),this.p=e.offset(this.$elem).round(),this},t}),function(){var e=0,t=["ms","moz","webkit","o"];for(var n=0;n<t.length&&!window.requestAnimationFrame;++n)window.requestAnimationFrame=window[t[n]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[t[n]+"CancelAnimationFrame"]||window[t[n]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(t){var n=(new Date).getTime(),r=Math.max(0,16-(n-e)),i=window.setTimeout(function(){t(n+r)},r);return e=n+r,i}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(e){clearTimeout(e)})}(),define("vendor/raf",function(){}),require.config({}),require(["Vector","Player","Platform","vendor/raf"],function(e,t,n){var r=$(window),i=$("body"),s=$("[data-player]"),o=function(e){var t=Array.prototype.slice.call(arguments,1);return function(n){return n[e].apply(n,t)}};i.css("min-height",window.innerHeight);var u=new t(s),a=0,f=$("[data-platform=top], [data-platform=both]").map(function(){var e=new n($(this),"top");return e.id=a++,e}).toArray();f=f.concat($("[data-platform=bottom], [data-platform=both]").map(function(){var e=new n($(this),"bottom");return e.id=a++,e}).toArray());var l=$("[data-trigger").map(function(){return new n($(this))}).toArray();r.resize(function(){i.css("min-height",window.innerHeight),f.map(o("update")),l.map(o("update"))}),u.findPaths(f),u.moveTo(f[0]),u.target=f[0];var c=function(e,t){var n=t[0],r=n.jumpDistanceFrom(e);return t.slice(1).map(function(t){var i=t.jumpDistanceFrom(e);i<r&&(r=i,n=t)}),n},h=Date.now||function(){return(new Date).getTime()},p=function(e,t){var n,r,i,s,o,u=function(){var a=h()-s;a<t?n=setTimeout(u,t-a):(n=null,o=e.apply(i,r),i=r=null)};return function(){return i=this,r=arguments,s=h(),n||(n=setTimeout(u,t)),o}},d=new e;i.mousemove(p(function(t){d.mouse(t);var n=c(d.add(new e(0,u.size.y()/2)),f);u.jumpTo(n,f),u.runTo(n.lateralRatio(d))},10));var v=function(){u.update(),u.draw();var e,t;for(var n=0;n<l.length;n++)t=l[n].$elem,e=l[n].distanceFromPlayer(u),e<=t.data("proximity")?((t.data("trigger")==="add-class"||t.data("trigger")==="toggle-class")&&t.addClass(t.data("class")),(t.data("trigger")==="remove-class"||t.data("trigger")==="reverse-toggle-class")&&t.removeClass(t.data("class"))):(t.data("trigger")==="toggle-class"&&t.removeClass(t.data("class")),t.data("trigger")==="reverse-toggle-class"&&t.addClass(t.data("class")));window.requestAnimationFrame(v)};v()}),define("config.js",function(){});